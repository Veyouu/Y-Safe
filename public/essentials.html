<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>First Aid Essentials - Y-SAFE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="header">
    <div class="container header-content">
      <div class="logo-section">
        <img src="images/LOGO.png?v=2" alt="Y-SAFE Logo" class="logo-image-small">
        <h1 class="site-title-small">Y-SAFE</h1>
      </div>
      <button class="btn-back" id="backBtn" onclick="window.location.href='dashboard.html'; return false;">‚Üê Dashboard</button>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <h1 class="page-title">First Aid Essentials</h1>
      <p class="page-description">Why it is important to have first aid essentials?</p>
      <p class="page-description">Having First Aid Essentials is important because it makes sure you are ready to give immediate help in an emergency or disaster while waiting for professional assistance.</p>
      
      <div class="essentials-section">
        <h2>Important Benefits:</h2>
        <div class="benefits-list">
          <div class="benefit-item">
            <div class="benefit-icon">ü©π</div>
            <h3>Control bleeding and prevent infection</h3>
          </div>
          <div class="benefit-item">
            <div class="benefit-icon">üõ°Ô∏è</div>
            <h3>Improve safety while waiting for rescue</h3>
          </div>
          <div class="benefit-item">
            <div class="benefit-icon">üíä</div>
            <h3>Provide immediate relief and protection</h3>
          </div>
          <div class="benefit-item">
            <div class="benefit-icon">‚ù§Ô∏è</div>
            <h3>Increase chances of saving lives</h3>
          </div>
        </div>
      </div>

      <div class="essentials-section">
        <h2>üéí First Aid Essentials</h2>
        <div class="kit-items">
          <div class="kit-item" data-item="flashlight">
            <div class="kit-icon">üî¶</div>
            <h3>Flashlight with batteries</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('flashlight')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="water">
            <div class="kit-icon">üíß</div>
            <h3>Drinking water</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('water')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="food">
            <div class="kit-icon">ü•´</div>
            <h3>Ready-to-eat food</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('food')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="firstaid">
            <div class="kit-icon">üéí</div>
            <h3>First aid kit</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('firstaid')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="triangular">
            <div class="kit-icon">üìê</div>
            <h3>Triangular Bandage</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('triangular')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="adhesive">
            <div class="kit-icon">ü©π</div>
            <h3>Adhesive Bandage</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('adhesive')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="whistle">
            <div class="kit-icon">üì¢</div>
            <h3>Emergency whistle</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('whistle')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="mask">
            <div class="kit-icon">üò∑</div>
            <h3>Face mask (for dust)</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('mask')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="gloves">
            <div class="kit-icon">üß§</div>
            <h3>Gloves</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('gloves')">View Lesson</button>
          </div>
          <div class="kit-item" data-item="blanket">
            <div class="kit-icon">üß•</div>
            <h3>Small blanket</h3>
            <button class="btn btn-lesson" onclick="openEssentialLesson('blanket')">View Lesson</button>
          </div>
        </div>
      </div>

      <div class="quiz-section">
        <div class="quiz-container">
          <h3>First Aid Essentials Quiz</h3>
          <p>Complete all topics above to unlock this quiz.</p>
          <button class="btn btn-primary quiz-btn" id="essentialsQuizBtn" onclick="startEssentialQuiz('essentials')" disabled>Start Quiz</button>
          <div class="quiz-progress">
            <span id="completedTopics">0</span> / <span id="totalTopics">10</span> topics completed
          </div>
        </div>
      </div>
    </div>
  </main>

  <div id="lessonModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle"></h2>
        <button class="modal-close" onclick="closeAllModals()">&times;</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-close-btn" onclick="closeAllModals()">Close</button>
        <button class="btn btn-success" id="markCompletedBtn" onclick="markEssentialCompleted()">Mark as Completed</button>
      </div>
    </div>
  </div>

  <div id="quizModal" class="modal">
    <div class="modal-content quiz-modal">
      <div class="modal-header">
        <h2 id="quizTitle">Quiz</h2>
        <button class="modal-close" onclick="closeAllModals()">&times;</button>
      </div>
      <div class="modal-body quiz-body">
        <div class="quiz-progress">
          <div class="quiz-progress-bar"></div>
          <span class="quiz-progress-text">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">5</span></span>
        </div>
        <div class="quiz-question" id="quizQuestion"></div>
        <div class="quiz-options" id="quizOptions"></div>
      </div>
      <div class="modal-footer quiz-footer">
        <button class="btn btn-primary" id="nextQuestionBtn" disabled>Next</button>
        <button class="btn btn-success" id="submitQuizBtn" style="display: none;">Submit Quiz</button>
      </div>
    </div>
  </div>

  <div id="quizResultModal" class="modal">
    <div class="modal-content result-modal">
      <div class="modal-header">
        <h2>Quiz Complete!</h2>
        <button class="modal-close" onclick="closeAllModals()">&times;</button>
      </div>
      <div class="modal-body result-body">
        <div class="result-icon">üéâ</div>
        <h3 id="resultScore"></h3>
        <p id="resultMessage"></p>
        <div class="result-details">
          <div class="detail-item">
            <span>Correct Answers:</span>
            <span id="correctCount"></span>
          </div>
          <div class="detail-item">
            <span>Total Questions:</span>
            <span id="totalCount"></span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary modal-close-btn" onclick="closeAllModals(); window.location.href='dashboard.html';">Back to Dashboard</button>
      </div>
    </div>
  </div>

  <script>
    // Embedded JavaScript to fix button issues
    console.log('Essentials page - embedded script loaded');
    
    // Track completed topics
    let completedTopics = {};
    try {
        completedTopics = JSON.parse(localStorage.getItem('y-safe-completed-topics') || '{}');
    } catch (e) {
        console.error('Error loading completed topics:', e);
        completedTopics = {};
    }
    
    let currentLesson = null;
    let currentQuiz = [];
    let currentQuestionIndex = 0;
    let correctAnswers = 0;
    let selectedOption = null;
    
    // Main lesson quiz data
    const mainLessonQuiz = {
        essentials: {
            title: 'First Aid Essentials Quiz',
            questions: [
                {
                    question: 'First aid plays an important role during emergencies. What best describes the main purpose of first aid?',
                    options: ['To replace doctors', 'To give immediate care before professional help arrives', 'To cure all injuries', 'To diagnose diseases'],
                    correct: 1
                },
                {
                    question: 'Power interruptions often happen during disasters. Which emergency item provides light and helps people see in the dark?',
                    options: ['Loud signaling device', 'Flashlight with batteries', 'Protective hand covering', 'Breathing protection gear'],
                    correct: 1
                },
                {
                    question: 'In emergency situations, access to clean water is limited. Why is drinking water an important part of emergency supplies?',
                    options: ['For cleaning floors', 'To prevent dehydration', 'For cooking meals', 'For washing clothes'],
                    correct: 1
                },
                {
                    question: 'When giving first aid to an injured person, protecting yourself is important. Which item helps prevent direct contact with blood or body fluids?',
                    options: ['Respiratory covering', 'Insulating cloth', 'Gloves', 'Audible alert device'],
                    correct: 2
                },
                {
                    question: 'In situations where help is needed but shouting is difficult, which emergency item is used to call attention and signal for help?',
                    options: ['Decoration', 'Signaling for help', 'Playing games', 'Calling friends'],
                    correct: 1
                }
            ]
        }
    };
    
    // First aid essentials items with lessons
    const essentials = {
        flashlight: {
            title: 'Flashlight with Batteries',
            content: '<h3>Flashlight with Batteries</h3><div class="lesson-image"><img src="images/flashlight with batteries.png" alt="Flashlight with batteries"></div><p>A flashlight is an essential item in any first aid kit or emergency preparedness kit.</p><h4>Purpose:</h4><ul><li>Provides light during power outages or dark conditions</li><li>Helps signal for help in emergencies</li><li>Aids in examining injuries in low light</li><li>Can be used to navigate in dark environments</li></ul><h4>Features to Look For:</h4><ul><li>LED bulbs for longer battery life</li><li>Water-resistant construction</li><li>Extra batteries included</li><li>Compact and durable design</li></ul><h4>Tips:</h4><ul><li>Check batteries regularly</li><li>Keep in easily accessible location</li><li>Consider rechargeable options</li></ul>'
        },
        water: {
            title: 'Drinking Water',
            content: '<h3>Drinking Water</h3><div class="lesson-image"><img src="images/drinking water.png" alt="Drinking water"></div><p>Clean drinking water is crucial for survival and first aid situations.</p><h4>Importance:</h4><ul><li>Prevents dehydration during emergencies</li><li>Essential for wound cleaning</li><li>Helps regulate body temperature</li><li>Needed for taking medications</li></ul><h4>Storage Guidelines:</h4><ul><li>Store at least 1 gallon per person per day</li><li>Keep in cool, dark place</li><li>Replace every 6 months</li><li>Use sealed, food-grade containers</li></ul><h4>Emergency Uses:</h4><ul><li>Cleaning wounds when no sterile water available</li><li>Rehydration after injury or illness</li><li>Cooling burns (as last resort)</li></ul>'
        },
        food: {
            title: 'Ready-to-Eat Food',
            content: '<h3>Ready-to-Eat Food</h3><div class="lesson-image"><img src="images/readty to eat.png" alt="Ready-to-eat food"></div><p>Non-perishable food items are essential for emergency preparedness.</p><h4>Types to Include:</h4><ul><li>Energy bars and granola</li><li>Dried fruits and nuts</li><li>Canned goods with pull tabs</li><li>Peanut butter and crackers</li></ul><h4>Storage Tips:</h4><ul><li>Check expiration dates regularly</li><li>Store in cool, dry place</li><li>Rotate supplies every 6 months</li><li>Include manual can opener</li></ul><h4>Considerations:</h4><ul><li>Dietary restrictions</li><li>Easy preparation</li><li>Minimal water requirement</li><li>High energy content</li></ul>'
        },
        firstaid: {
            title: 'First Aid Kit',
            content: '<h3>First Aid Kit</h3><div class="lesson-image"><img src="images/firstaidkit.png" alt="First aid kit"></div><p>A comprehensive first aid kit is the cornerstone of emergency preparedness.</p><h4>Essential Contents:</h4><ul><li>Various bandage sizes</li><li>Antiseptic wipes and solution</li><li>Pain relievers</li><li>Tweezers and scissors</li><li>Medical tape and gauze</li></ul><h4>Additional Items:</h4><ul><li>Emergency contact information</li><li>Medical history forms</li><li>First aid manual</li><li>Emergency blanket</li></ul><h4>Maintenance:</h4><ul><li>Check monthly for expired items</li><li>Restock used supplies immediately</li><li>Keep in waterproof container</li><li>Store in accessible location</li></ul>'
        },
        triangular: {
            title: 'Triangular Bandage',
            content: '<h3>Triangular Bandage</h3><div class="lesson-image"><img src="images/triangular bandage.png" alt="Triangular Bandage"></div><p>A versatile bandage that can be used in multiple emergency situations.</p><h4>Common Uses:</h4><ul><li>Creating arm slings for injuries</li><li>Securing dressings on wounds</li><li>Immobilizing sprains and strains</li><li>Applying pressure to control bleeding</li><li>Making tourniquets (emergency only)</li></ul><h4>Proper Folding Techniques:</h4><ul><li>Cravat fold for narrow bandages</li><li>Broad fold for large areas</li><li>Saddle fold for special applications</li></ul><h4>Advantages:</h4><ul><li>Reusable and washable</li><li>Multiple configurations</li><li>Lightweight and compact</li><li>Cost-effective</li></ul>'
        },
        adhesive: {
            title: 'Adhesive Bandage',
            content: '<h3>Adhesive Bandage</h3><div class="lesson-image"><img src="images/adhesive bandage.png" alt="Adhesive Bandage"></div><p>Adhesive bandages are essential for protecting minor cuts and scrapes.</p><h4>Types Available:</h4><ul><li>Standard strip bandages</li><li>Butterfly closures for deep cuts</li><li>Finger tip bandages</li><li>Knuckle bandages</li><li>Large wound dressings</li></ul><h4>Proper Application:</h4><ul><li>Clean wound thoroughly first</li><li>Choose appropriate size</li><li>Apply sterile pad to wound</li><li>Ensure good adhesive contact</li><li>Change daily or when wet</li></ul><h4>Storage:</h4><ul><li>Keep in original packaging</li><li>Store in cool, dry place</li><li>Check regularly for damage</li></ul>'
        },
        whistle: {
            title: 'Emergency Whistle',
            content: '<h3>Emergency Whistle</h3><div class="lesson-image"><img src="images/emergency whistle.png" alt="Emergency whistle"></div><p>A whistle is a crucial signaling device in emergency situations.</p><h4>Purpose:</h4><ul><li>Signals for rescue over long distances</li><li>Works when voice is lost or weak</li><li>Universal emergency signal</li><li>Requires minimal energy to use</li></ul><h4>Emergency Signals:</h4><ul><li>Three blasts: Universal distress signal</li><li>One blast: Attention needed</li><li>Continuous blast: Immediate danger</li></ul><h4>Features to Consider:</h4><ul><li>Pealess design (won\'t freeze)</li><li>High decibel rating</li><li>Lanyard for easy access</li><li>Bright color for visibility</li></ul>'
        },
        mask: {
            title: 'Face Mask (for Dust)',
            content: '<h3>Face Mask for Dust Protection</h3><div class="lesson-image"><img src="images/facemask.png" alt="Face mask"></div><p>Face masks protect the respiratory system from harmful particles.</p><h4>Types of Protection:</h4><ul><li>Dust particles from debris</li><li>Smoke inhalation</li><li>Chemical fumes</li><li>Disease prevention</li></ul><h4>Emergency Situations:</h4><ul><li>Natural disasters (earthquakes, fires)</li><li>Building collapses</li><li>Industrial accidents</li><li>Pandemic outbreaks</li></ul><h4>Proper Usage:</h4><ul><li>Ensure proper fit over nose and mouth</li><li>Check for gaps around edges</li><li>Change when wet or damaged</li><li>Dispose properly after use</li></ul>'
        },
        gloves: {
            title: 'Gloves',
            content: '<h3>Gloves</h3><div class="lesson-image"><img src="images/safety gloves.png" alt="Gloves"></div><p>Protective gloves are essential for both rescuer and injured person.</p><h4>Protection Benefits:</h4><ul><li>Prevents disease transmission</li><li>Protects from bloodborne pathogens</li><li>Keeps wounds clean during treatment</li><li>Provides grip in slippery conditions</li></ul><h4>Types of Gloves:</h4><ul><li>Latex examination gloves</li><li>Nitrile for latex allergies</li><li>Vinyl for basic protection</li><li>Heavy-duty for cleanup</li></ul><h4>Proper Use:</h4><ul><li>Check for tears before use</li><li>Change between patients</li><li>Dispose properly after use</li><li>Wash hands after removal</li></ul>'
        },
        blanket: {
            title: 'Small Blanket',
            content: '<h3>Small Blanket</h3><div class="lesson-image"><img src="images/small blanket.png" alt="Small blanket"></div><p>An emergency blanket provides warmth and protection in various situations.</p><h4>Uses in First Aid:</h4><ul><li>Preventing hypothermia</li><li>Comfort for shock victims</li><li>Making temporary shelters</li><li>Ground insulation</li></ul><h4>Types Available:</h4><ul><li>Wool for warmth</li><li>Emergency space blankets</li><li>Fleece for lightweight warmth</li><li>All-purpose utility blankets</li></ul><h4>Emergency Blanket Features:</h4><ul><li>Compact and lightweight</li><li>Water-resistant backing</li><li>Bright color for visibility</li><li>Durable construction</li></ul>'
        }
    };
    
    // Button functions
    function openEssentialLesson(itemId) {
        console.log('Essential lesson clicked:', itemId);
        
        if (!essentials[itemId]) {
            alert('Lesson not found: ' + itemId);
            return;
        }
        
        const lesson = essentials[itemId];
        currentLesson = { title: lesson.title, id: itemId };
        
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modal = document.getElementById('lessonModal');
        
        if (!modalTitle || !modalBody || !modal) {
            alert('Modal elements not found');
            return;
        }
        
        modalTitle.textContent = lesson.title;
        modalBody.innerHTML = lesson.content;
        modal.classList.add('active');
        modal.style.display = 'flex';
        
        // Update Mark as Completed button state
        const markBtn = document.getElementById('markCompletedBtn');
        if (markBtn) {
            if (completedTopics[itemId]) {
                markBtn.textContent = 'Completed';
                markBtn.disabled = true;
                markBtn.classList.add('btn-secondary');
                markBtn.classList.remove('btn-success');
            } else {
                markBtn.textContent = 'Mark as Completed';
                markBtn.disabled = false;
                markBtn.classList.add('btn-success');
                markBtn.classList.remove('btn-secondary');
            }
        }
        
        console.log('Essential lesson opened successfully');
    }
    
    function closeAllModals() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.classList.remove('active');
            modal.style.display = 'none';
        });
        document.body.style.overflow = 'auto';
    }
    
    function markEssentialCompleted() {
        const itemId = getCurrentLessonId();
        if (!itemId || completedTopics[itemId]) return;

        completedTopics[itemId] = true;
        localStorage.setItem('y-safe-completed-topics', JSON.stringify(completedTopics));

        // Update lesson card
        const card = document.querySelector(`[data-item="${itemId}"]`);
        if (card) {
            card.classList.add('completed');
        }

        // Update button
        const markBtn = document.getElementById('markCompletedBtn');
        if (markBtn) {
            markBtn.textContent = 'Completed';
            markBtn.disabled = true;
            markBtn.classList.add('btn-secondary');
            markBtn.classList.remove('btn-success');
        }

        updateQuizButton();
        updateCompletedTopics();
    }
    
    function startEssentialQuiz(lessonType) {
        console.log('Starting essentials quiz:', lessonType);
        currentQuiz = [...mainLessonQuiz[lessonType].questions];
        currentQuestionIndex = 0;
        correctAnswers = 0;

        const quizTitle = document.getElementById('quizTitle');
        const totalQuestions = document.getElementById('totalQuestions');
        const quizModal = document.getElementById('quizModal');
        const nextBtn = document.getElementById('nextQuestionBtn');
        const submitBtn = document.getElementById('submitQuizBtn');
        
        if (!quizTitle || !totalQuestions || !quizModal || !nextBtn || !submitBtn) {
            alert('Quiz elements not found');
            return;
        }
        
        quizTitle.textContent = mainLessonQuiz[lessonType].title;
        totalQuestions.textContent = currentQuiz.length;
        quizModal.classList.add('active');
        quizModal.style.display = 'flex';

        showQuestion();
        nextBtn.style.display = 'inline-flex';
        submitBtn.style.display = 'none';
    }
    
    function showQuestion() {
        const question = currentQuiz[currentQuestionIndex];
        const questionElement = document.getElementById('quizQuestion');
        const optionsContainer = document.getElementById('quizOptions');
        const currentQuestionSpan = document.getElementById('currentQuestion');
        
        if (!questionElement || !optionsContainer || !currentQuestionSpan) {
            alert('Question elements not found');
            return;
        }
        
        currentQuestionSpan.textContent = currentQuestionIndex + 1;
        questionElement.textContent = question.question;

        optionsContainer.innerHTML = '';

        question.options.forEach((option, index) => {
            const optionElement = document.createElement('div');
            optionElement.className = 'quiz-option';
            optionElement.textContent = option;
            optionElement.onclick = function() {
                selectOption(index, this);
            };
            optionsContainer.appendChild(optionElement);
        });

        const nextBtn = document.getElementById('nextQuestionBtn');
        if (nextBtn) nextBtn.disabled = true;
    }
    
    function selectOption(index, element) {
        const options = document.querySelectorAll('.quiz-option');
        options.forEach(opt => opt.classList.remove('selected'));

        element.classList.add('selected');
        selectedOption = index;
        const nextBtn = document.getElementById('nextQuestionBtn');
        if (nextBtn) nextBtn.disabled = false;
    }
    
    function handleNextQuestion() {
        const correctAnswer = currentQuiz[currentQuestionIndex].correct;

        const options = document.querySelectorAll('.quiz-option');
        options.forEach((opt, idx) => {
            opt.style.pointerEvents = 'none';
            if (idx === correctAnswer) {
                opt.classList.add('correct');
            } else if (idx === selectedOption && idx !== correctAnswer) {
                opt.classList.add('incorrect');
            }
        });

        if (selectedOption === correctAnswer) {
            correctAnswers++;
        }

        setTimeout(() => {
            currentQuestionIndex++;
            selectedOption = null;

            if (currentQuestionIndex < currentQuiz.length) {
                showQuestion();
            } else {
                const nextBtn = document.getElementById('nextQuestionBtn');
                const submitBtn = document.getElementById('submitQuizBtn');
                if (nextBtn) nextBtn.style.display = 'none';
                if (submitBtn) submitBtn.style.display = 'inline-flex';
            }
        }, 1500);
    }
    
    function showResults() {
        const score = Math.round((correctAnswers / currentQuiz.length) * 100);
        const total = currentQuiz.length;

        const resultScore = document.getElementById('resultScore');
        const correctCount = document.getElementById('correctCount');
        const totalCount = document.getElementById('totalCount');
        const resultMessage = document.getElementById('resultMessage');
        const resultModal = document.getElementById('quizResultModal');

        if (!resultScore || !correctCount || !totalCount || !resultMessage || !resultModal) {
            alert('Result elements not found');
            return;
        }

        resultScore.textContent = `${score}%`;
        correctCount.textContent = correctAnswers;
        totalCount.textContent = total;

        let message = '';
        if (score === 100) {
            message = 'Perfect! You\'re a safety expert!';
        } else if (score >= 80) {
            message = 'Excellent work! You have great knowledge!';
        } else if (score >= 60) {
            message = 'Good job! Keep learning to improve!';
        } else {
            message = 'Keep practicing! Review the lesson and try again.';
        }

        resultMessage.textContent = message;
        resultModal.classList.add('active');
        resultModal.style.display = 'flex';
    }
    
    function updateQuizButton() {
        const essentialItems = Object.keys(essentials);
        const completedCount = essentialItems.filter(id => completedTopics[id]).length;

        const quizBtn = document.getElementById('essentialsQuizBtn');
        if (quizBtn) {
            if (completedCount === essentialItems.length) {
                quizBtn.disabled = false;
                quizBtn.textContent = 'Start Quiz';
            } else {
                quizBtn.disabled = true;
                quizBtn.textContent = `Complete ${essentialItems.length - completedCount} more topic${essentialItems.length - completedCount > 1 ? 's' : ''}`;
            }
        }
    }
    
    function updateCompletedTopics() {
        const essentialItems = Object.keys(essentials);
        const completedCount = essentialItems.filter(id => completedTopics[id]).length;

        const completedSpan = document.getElementById('completedTopics');
        const totalSpan = document.getElementById('totalTopics');
        if (completedSpan && totalSpan) {
            completedSpan.textContent = completedCount;
            totalSpan.textContent = essentialItems.length;
        }
    }
    
    function getCurrentLessonId() {
        return currentLesson ? currentLesson.id : null;
    }
    
    // Initialize page
    function initializePage() {
        console.log('Initializing essentials page...');
        
        // Mark completed topics
        const kitItems = document.querySelectorAll('.kit-item');
        kitItems.forEach(item => {
            const itemId = item.dataset.item;
            if (completedTopics[itemId]) {
                item.classList.add('completed');
            }
        });
        
        updateQuizButton();
        updateCompletedTopics();
        
        // Add event listeners for buttons that don't have inline handlers
        const nextBtn = document.getElementById('nextQuestionBtn');
        if (nextBtn) {
            nextBtn.onclick = handleNextQuestion;
        }
        
        const submitBtn = document.getElementById('submitQuizBtn');
        if (submitBtn) {
            submitBtn.onclick = function() {
                document.getElementById('quizModal').classList.remove('active');
                showResults();
            };
        }
        
        console.log('Essentials page initialized successfully');
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', initializePage);
    
    // Also try immediate initialization
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializePage);
    } else {
        initializePage();
    }
  </script>
</body>
</html>
