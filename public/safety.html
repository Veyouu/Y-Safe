<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Safety Awareness - Y-SAFE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="header">
    <div class="container header-content">
      <div class="logo-section">
        <img src="images/LOGO.png?v=2" alt="Y-SAFE Logo" class="logo-image-small">
        <h1 class="site-title-small">Y-SAFE</h1>
      </div>
      <button class="btn-back" id="backBtn" onclick="window.location.href='dashboard.html'; return false;">‚Üê Dashboard</button>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <h1 class="page-title">Safety Awareness</h1>
      <p class="page-description">Why being aware of risks can save lives?</p>
      <p class="page-description">Being aware of risks can save lives because it helps people recognize danger early and take the right action before an accident becomes serious. When a person knows what is unsafe, they can avoid harm, stay calm during emergencies, and respond quickly to protect themselves and others.</p>

      <div class="safety-sections">
        <div class="section">
          <h2 class="section-title">Different Types of Calamities</h2>
          <div class="lessons-grid">
            <div class="lesson-card" data-lesson="fire">
              <div class="lesson-icon">üî•</div>
              <h3>Fire Safety</h3>
              <p>Fire safety is important to prevent injuries and loss of life during fire incidents.</p>
              <button class="btn btn-lesson" onclick="openLesson('fire')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="earthquake">
              <div class="lesson-icon">üåç</div>
              <h3>Earthquake Warning Signs</h3>
              <p>Earthquake warning signs help people prepare and respond quickly before and during shaking.</p>
              <button class="btn btn-lesson" onclick="openLesson('earthquake')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="evacuation">
              <div class="lesson-icon">üåÄ</div>
              <h3>Importance of Evacuation Plans and Safe Areas for Typhoons</h3>
              <p>Evacuation plans and safe areas protect lives during strong typhoons and flooding.</p>
              <button class="btn btn-lesson" onclick="openLesson('evacuation')">View Lesson</button>
            </div>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">Different Kinds of Injuries</h2>
          <div class="lessons-grid">
            <div class="lesson-card" data-lesson="cuts-wounds">
              <div class="lesson-icon">ü©π</div>
              <h3>Cuts and Wounds</h3>
              <p>Learn about different types of cuts, wounds, and how to properly treat them.</p>
              <button class="btn btn-lesson" onclick="openLesson('cuts-wounds')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="bleeding">
              <div class="lesson-icon">ü©∏</div>
              <h3>Bleeding Injuries</h3>
              <p>Understand various bleeding injuries and proper first aid response.</p>
              <button class="btn btn-lesson" onclick="openLesson('bleeding')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="burns">
              <div class="lesson-icon">üî•</div>
              <h3>Burns and Scalds</h3>
              <p>Learn about different burn types and appropriate treatment methods.</p>
              <button class="btn btn-lesson" onclick="openLesson('burns')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="bone-joint">
              <div class="lesson-icon">ü¶¥</div>
              <h3>Bone, Joint, and Muscle Injuries</h3>
              <p>Identify and respond to fractures, sprains, strains, and dislocations.</p>
              <button class="btn btn-lesson" onclick="openLesson('bone-joint')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="head-spine">
              <div class="lesson-icon">üß†</div>
              <h3>Head and Spine Injuries</h3>
              <p>Recognize serious head and spinal injuries and proper emergency response.</p>
              <button class="btn btn-lesson" onclick="openLesson('head-spine')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="breathing-chest">
              <div class="lesson-icon">ü´Å</div>
              <h3>Breathing and Chest Injuries</h3>
              <p>Learn to respond to choking, chest wounds, and breathing emergencies.</p>
              <button class="btn btn-lesson" onclick="openLesson('breathing-chest')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="heat-cold">
              <div class="lesson-icon">üå°Ô∏è</div>
              <h3>Heat and Cold Injuries</h3>
              <p>Prevent and treat heat exhaustion, heat stroke, hypothermia, and frostbite.</p>
              <button class="btn btn-lesson" onclick="openLesson('heat-cold')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="poisoning-bites">
              <div class="lesson-icon">üêç</div>
              <h3>Poisoning and Bites</h3>
              <p>Respond to poisoning incidents and various animal bites and stings.</p>
              <button class="btn btn-lesson" onclick="openLesson('poisoning-bites')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="medical-emergencies">
              <div class="lesson-icon">üöë</div>
              <h3>Medical Emergencies</h3>
              <p>Recognize and respond to heart attacks, strokes, seizures, and other medical emergencies.</p>
              <button class="btn btn-lesson" onclick="openLesson('medical-emergencies')">View Lesson</button>
            </div>

            <div class="lesson-card" data-lesson="eye-ear-dental">
              <div class="lesson-icon">üëÅÔ∏è</div>
              <h3>Eye, Ear, and Dental Injuries</h3>
              <p>Provide first aid for eye, ear, and dental injuries and foreign objects.</p>
              <button class="btn btn-lesson" onclick="openLesson('eye-ear-dental')">View Lesson</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="quiz-section">
        <div class="quiz-container">
          <h3>Safety Awareness Quiz</h3>
          <p>Complete all topics above to unlock this quiz.</p>
          <button class="btn btn-primary quiz-btn" id="safetyQuizBtn" onclick="startMainQuiz('safety')" disabled>Start Quiz</button>
          <div class="quiz-progress">
            <span id="completedTopics">0</span> / <span id="totalTopics">13</span> topics completed
          </div>
        </div>
      </div>
    </div>
  </main>

  <div id="lessonModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle"></h2>
        <button class="modal-close" onclick="closeAllModals()">&times;</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-close-btn" onclick="closeAllModals()">Close</button>
        <button class="btn btn-success" id="markCompletedBtn" onclick="markTopicCompleted()">Mark as Completed</button>
      </div>
    </div>
  </div>

  <div id="quizModal" class="modal">
    <div class="modal-content quiz-modal">
      <div class="modal-header">
        <h2 id="quizTitle">Quiz</h2>
        <button class="modal-close" onclick="closeAllModals()">&times;</button>
      </div>
      <div class="modal-body quiz-body">
        <div class="quiz-progress">
          <div class="quiz-progress-bar"></div>
          <span class="quiz-progress-text">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">5</span></span>
        </div>
        <div class="quiz-question" id="quizQuestion"></div>
        <div class="quiz-options" id="quizOptions"></div>
      </div>
      <div class="modal-footer quiz-footer">
        <button class="btn btn-primary" id="nextQuestionBtn" disabled>Next</button>
        <button class="btn btn-success" id="submitQuizBtn" style="display: none;">Submit Quiz</button>
      </div>
    </div>
  </div>

  <div id="quizResultModal" class="modal">
    <div class="modal-content result-modal">
      <div class="modal-header">
        <h2>Quiz Complete!</h2>
        <button class="modal-close" onclick="closeAllModals()">&times;</button>
      </div>
      <div class="modal-body result-body">
        <div class="result-icon">üéâ</div>
        <h3 id="resultScore"></h3>
        <p id="resultMessage"></p>
        <div class="result-details">
          <div class="detail-item">
            <span>Correct Answers:</span>
            <span id="correctCount"></span>
          </div>
          <div class="detail-item">
            <span>Total Questions:</span>
            <span id="totalCount"></span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary modal-close-btn" onclick="closeAllModals()">Continue</button>
      </div>
    </div>
  </div>

  <script>
    // Embedded JavaScript to fix button issues
    console.log('Safety page - embedded script loaded');
    
    // Track completed topics
    let completedTopics = {};
    try {
        completedTopics = JSON.parse(localStorage.getItem('y-safe-completed-topics') || '{}');
    } catch (e) {
        console.error('Error loading completed topics:', e);
        completedTopics = {};
    }
    
    let currentLesson = null;
    let currentQuiz = [];
    let currentQuestionIndex = 0;
    let correctAnswers = 0;
    let selectedOption = null;
    
    // Lesson data (simplified version for embedded script)
    const lessons = {
        fire: {
            title: 'Fire Safety',
            content: '<h3>Fire Safety</h3><p>Fire safety is important to prevent injuries and loss of life during fire incidents.</p><h4>Basic Safety Tips:</h4><ul><li>Keep flammable materials away from heat and open flames.</li><li>Do not overload electrical outlets or use damaged wires.</li><li>Turn off appliances when not in use.</li><li>Know the location of fire exits and fire extinguishers.</li><li>Stay calm during a fire and avoid using elevators.</li><li>If there is smoke, stay low and cover your nose and mouth with a cloth.</li></ul>',
            quiz: []
        },
        earthquake: {
            title: 'Earthquake Warning Signs',
            content: '<h3>Earthquake Warning Signs</h3><p>Earthquake warning signs help people prepare and respond quickly before and during shaking.</p><h4>Basic Safety Tips:</h4><ul><li>Be alert to unusual ground movement or rumbling sounds.</li><li>Secure heavy objects and furniture to prevent falling.</li><li>Learn and practice the "Duck, Cover, and Hold" procedure.</li><li>Stay away from windows, shelves, and hanging objects.</li><li>After the shaking stops, move carefully to a safe area.</li></ul>',
            quiz: []
        },
        evacuation: {
            title: 'Importance of Evacuation Plans and Safe Areas for Typhoons',
            content: '<h3>Importance of Evacuation Plans and Safe Areas for Typhoons</h3><p>Evacuation plans and safe areas protect lives during strong typhoons and flooding.</p><h4>Basic Safety Tips:</h4><ul><li>Know your community\'s evacuation routes and designated safe areas.</li><li>Follow weather updates and warnings from authorities.</li><li>Prepare an emergency bag with food, water, and first-aid supplies.</li><li>Evacuate early when advised to avoid danger.</li><li>Stay in safe shelters until officials declare it safe to return.</li></ul>',
            quiz: []
        },
        'cuts-wounds': {
            title: 'Cuts and Wounds',
            content: '<h3>Cuts and Wounds</h3><p>Cuts and wounds are common injuries that require proper first aid to prevent infection and promote healing.</p><h4>Types of Cuts and Wounds:</h4><ul><li>Minor cuts: Small, shallow cuts that affect only the top layer of skin</li><li>Deep cuts (lacerations): Deep cuts that may damage muscles, tendons, or nerves</li><li>Abrasions (scrapes): Wounds where skin is scraped off, usually not deep</li><li>Puncture wounds: Deep, narrow wounds caused by sharp objects like nails or needles</li></ul><h4>First Aid Treatment:</h4><ul><li>Wash your hands before treating the wound</li><li>Apply gentle pressure with clean cloth to stop bleeding</li><li>Clean the wound with clean water or saline solution</li><li>Apply antibiotic ointment to prevent infection</li><li>Cover the wound with sterile bandage or dressing</li><li>Seek medical help for deep cuts, puncture wounds, or if bleeding doesn\'t stop</li></ul>',
            quiz: []
        },
        bleeding: {
            title: 'Bleeding Injuries',
            content: '<h3>Bleeding Injuries</h3><p>Bleeding injuries can range from minor to life-threatening. Proper first aid is crucial to prevent blood loss.</p><h4>Types of Bleeding Injuries:</h4><ul><li>Minor bleeding: Small cuts that stop bleeding quickly with minimal pressure</li><li>Severe bleeding (hemorrhage): Heavy bleeding that can be life-threatening</li><li>Internal bleeding: Bleeding inside the body that may not be visible</li></ul><h4>First Aid for External Bleeding:</h4><ul><li>Apply direct pressure with clean cloth or bandage</li><li>Elevate the injured area above heart level if possible</li><li>Apply pressure to pressure points if direct pressure fails</li><li>Use a tourniquet only as last resort for severe limb bleeding</li><li>Keep the person warm and calm</li><li>Call emergency services for severe bleeding</li></ul>',
            quiz: []
        },
        burns: {
            title: 'Burns and Scalds',
            content: '<h3>Burns and Scalds</h3><p>Burns and scalds are injuries to body tissues caused by heat, chemicals, electricity, or radiation.</p><h4>Types of Burns:</h4><ul><li>First-degree burns: Red, painful skin that affects only the outer layer</li><li>Second-degree burns: Blisters, thickened skin, more intense pain</li><li>Third-degree burns: White, brown, or black skin, may be numb due to nerve damage</li><li>Chemical burns: Caused by acids, alkalis, or other chemicals</li><li>Electrical burns: Caused by electricity, may have internal damage</li><li>Sunburns: Caused by UV radiation from the sun</li><li>Scalds: Burns from hot liquids or steam</li></ul><h4>First Aid for Minor Burns:</h4><ul><li>Cool the burn with cool (not cold) running water for 10-20 minutes</li><li>Remove jewelry or tight clothing from burned area</li><li>Cover the burn with sterile, non-stick bandage</li><li>Take over-the-counter pain medication if needed</li><li>Apply aloe vera gel to sunburns</li></ul>',
            quiz: []
        },
        'bone-joint': {
            title: 'Bone, Joint, and Muscle Injuries',
            content: '<h3>Bone, Joint, and Muscle Injuries</h3><p>These injuries affect the musculoskeletal system and require proper first aid to prevent further damage.</p><h4>Types of Injuries:</h4><ul><li>Sprains: Stretching or tearing of ligaments (tissues connecting bones)</li><li>Strains: Stretching or tearing of muscles or tendons</li><li>Fractures: Broken bones, can be complete or partial</li><li>Dislocations: Bones forced out of normal position at joints</li><li>Muscle cramps: Sudden, involuntary muscle contractions</li></ul><h4>First Aid for Sprains and Strains:</h4><ul><li>Follow RICE method: Rest, Ice, Compression, Elevation</li><li>Rest the injured area and avoid weight-bearing</li><li>Apply ice for 15-20 minutes every 2-3 hours</li><li>Compress with elastic bandage</li><li>Elevate above heart level</li></ul>',
            quiz: []
        },
        'head-spine': {
            title: 'Head and Spine Injuries',
            content: '<h3>Head and Spine Injuries</h3><p>Head and spine injuries are serious and can be life-threatening. Proper handling is crucial to prevent further damage.</p><h4>Types of Head Injuries:</h4><ul><li>Minor head injury: Small bump or cut, no loss of consciousness</li><li>Concussion: Brain injury causing temporary loss of brain function</li><li>Skull fracture: Break in the skull bone</li><li>Spinal injury: Damage to spinal cord or vertebrae</li></ul><h4>Signs of Serious Head Injury:</h4><ul><li>Loss of consciousness, even briefly</li><li>Confusion or disorientation</li><li>Severe headache</li><li>Nausea or vomiting</li><li>Slurred speech</li><li>Vision changes</li><li>Seizures</li><li>Blood or fluid from ears or nose</li></ul>',
            quiz: []
        },
        'breathing-chest': {
            title: 'Breathing and Chest Injuries',
            content: '<h3>Breathing and Chest Injuries</h3><p>Breathing and chest injuries can quickly become life-threatening. Immediate action is essential.</p><h4>Types of Breathing Emergencies:</h4><ul><li>Choking: Airway blocked by foreign object</li><li>Chest wounds: Open or closed injuries to chest</li><li>Collapsed lung: Air enters chest cavity, compressing lung</li><li>Asthma attack: Severe difficulty breathing due to asthma</li></ul><h4>Signs of Choking:</h4><ul><li>Cannot speak, breathe, or cough</li><li>Universal choking sign (hands clutching throat)</li><li>Blue lips or skin</li><li>High-pitched wheezing or no sound at all</li></ul>',
            quiz: []
        },
        'heat-cold': {
            title: 'Heat and Cold Injuries',
            content: '<h3>Heat and Cold Injuries</h3><p>Extreme temperatures can cause serious injuries. Prevention and proper first aid are essential.</p><h4>Heat-Related Injuries:</h4><ul><li>Heat exhaustion: Body overheats due to excessive heat exposure</li><li>Heat stroke: Life-threatening condition where body temperature regulation fails</li></ul><h4>Cold-Related Injuries:</h4><ul><li>Hypothermia: Dangerous drop in body temperature</li><li>Frostbite: Freezing of body tissues, usually extremities</li></ul><h4>First Aid Treatment:</h4><ul><li>Heat exhaustion: Move to cool place, drink water, apply cool compresses</li><li>Heat stroke: Call 911, cool body rapidly with water and fans</li><li>Hypothermia: Move to warm place, remove wet clothes, warm with blankets</li><li>Frostbite: Warm area gently, don\'t rub, seek medical care</li></ul>',
            quiz: []
        },
        'poisoning-bites': {
            title: 'Poisoning and Bites',
            content: '<h3>Poisoning and Bites</h3><p>Poisoning and animal bites can be serious emergencies requiring immediate action.</p><h4>Types of Poisoning:</h4><ul><li>Food poisoning: Illness from contaminated food</li><li>Chemical poisoning: Exposure to toxic chemicals</li><li>Drug overdose: Excessive medication or drug intake</li></ul><h4>Animal Bites and Stings:</h4><ul><li>Insect bites and stings: Bees, wasps, ants, spiders</li><li>Animal bites: Dogs, cats, other animals</li><li>Snake bites: Venomous or non-venomous snakes</li></ul><h4>First Aid for Poisoning:</h4><ul><li>Call poison control center immediately</li><li>Don\'t induce vomiting unless instructed</li><li>Have person sip water if conscious</li><li>Preserve container or substance for identification</li><li>Follow specific instructions from poison control</li></ul>',
            quiz: []
        },
        'medical-emergencies': {
            title: 'Medical Emergencies',
            content: '<h3>Medical Emergencies</h3><p>Medical emergencies require immediate recognition and response to save lives.</p><h4>Types of Medical Emergencies:</h4><ul><li>Fainting: Temporary loss of consciousness</li><li>Seizures: Uncontrolled electrical activity in brain</li><li>Heart attack: Blockage of blood flow to heart muscle</li><li>Stroke: Interruption of blood flow to brain</li><li>Diabetic emergency: Very high or low blood sugar</li><li>Allergic reaction (anaphylaxis): Severe, life-threatening allergic response</li></ul><h4>Heart Attack Signs:</h4><ul><li>Chest pain or pressure</li><li>Pain spreading to arms, back, neck, jaw</li><li>Shortness of breath</li><li>Cold sweat, nausea, lightheadedness</li></ul>',
            quiz: []
        },
        'eye-ear-dental': {
            title: 'Eye, Ear, and Dental Injuries',
            content: '<h3>Eye, Ear, and Dental Injuries</h3><p>Injuries to eyes, ears, and teeth require careful first aid to prevent permanent damage.</p><h4>Eye Injuries:</h4><ul><li>Foreign object in eye: Dust, sand, metal, or other particles</li><li>Chemical splashes: Acids, alkalis, or other chemicals</li><li>Blows to eye: Direct impact causing swelling or damage</li><li>Cuts or punctures: Sharp object injuries to eye</li></ul><h4>Foreign Object in Eye Treatment:</h4><ul><li>Don\'t rub the eye</li><li>Let tears wash out object</li><li>Lift upper eyelid over lower eyelid</li><li>Use eye wash or clean water to rinse</li><li>Don\'t use tweezers or cotton swabs</li><li>Seek medical care if object doesn\'t come out</li></ul>',
            quiz: []
        }
    };
    
    // Main quiz data
    const mainLessonQuiz = {
        safety: {
            title: 'Safety Awareness Quiz',
            questions: [
                {
                    question: 'Safety awareness helps people avoid accidents and injuries. Which statement best explains why being aware of risks can save lives?',
                    options: ['It encourages people to rely on emergency responders at all times', 'It allows individuals to focus less on warning signs', 'It helps people recognize danger early and take right action', 'It guarantees that accidents will never happen'],
                    correct: 2
                },
                {
                    question: 'Fire accidents often happen due to unsafe practices at home or school. Which action helps reduce the risk of fire incidents?',
                    options: ['Using multiple extension cords for convenience', 'Repairing appliances only after damage occurs', 'Keeping flammable materials away from heat and open flames', 'Leaving electrical devices on standby mode'],
                    correct: 2
                },
                {
                    question: 'During a fire, smoke inhalation can be very dangerous. What is the safest action to do when there is thick smoke in the area?',
                    options: ['Run fast', 'Stay low and cover your nose and mouth', 'Use elevator', 'Hide under a table'],
                    correct: 1
                },
                {
                    question: 'Being prepared before a fire emergency is important. What information should every person know in advance?',
                    options: ['Where to buy firecrackers', 'Location of fire exits and extinguishers', 'Where to park vehicles', 'Where to charge phones'],
                    correct: 1
                },
                {
                    question: 'Earthquakes may happen without warning, but there are signs that can alert people. Which of the following may indicate an approaching earthquake?',
                    options: ['Heavy rain', 'Strong wind', 'Unusual ground movement or rumbling', 'Brownout'],
                    correct: 2
                }
            ]
        }
    };
    
    // Button functions
    function goToDashboard() {
        console.log('Dashboard button clicked');
        alert('Going to dashboard');
        window.location.href = 'dashboard.html';
    }
    
    function openLesson(lessonId) {
        console.log('Lesson button clicked:', lessonId);
        
        if (!lessons[lessonId]) {
            alert('Lesson not found: ' + lessonId);
            return;
        }
        
        const lesson = lessons[lessonId];
        currentLesson = lessonId;
        
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modal = document.getElementById('lessonModal');
        
        if (!modalTitle || !modalBody || !modal) {
            alert('Modal elements not found');
            return;
        }
        
        modalTitle.textContent = lesson.title;
        modalBody.innerHTML = lesson.content;
        modal.classList.add('active');
        modal.style.display = 'flex';
        
        // Update Mark as Completed button state
        const markBtn = document.getElementById('markCompletedBtn');
        if (markBtn) {
            if (completedTopics[lessonId]) {
                markBtn.textContent = 'Completed';
                markBtn.disabled = true;
                markBtn.classList.add('btn-secondary');
                markBtn.classList.remove('btn-success');
            } else {
                markBtn.textContent = 'Mark as Completed';
                markBtn.disabled = false;
                markBtn.classList.add('btn-success');
                markBtn.classList.remove('btn-secondary');
            }
        }
        
        console.log('Lesson opened successfully');
    }
    
    function closeAllModals() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.classList.remove('active');
            modal.style.display = 'none';
        });
        document.body.style.overflow = 'auto';
    }
    
    function markTopicCompleted() {
        const lessonId = currentLesson;
        if (!lessonId || completedTopics[lessonId]) return;

        completedTopics[lessonId] = true;
        localStorage.setItem('y-safe-completed-topics', JSON.stringify(completedTopics));

        // Update lesson card
        const card = document.querySelector(`[data-lesson="${lessonId}"]`);
        if (card) {
            card.classList.add('completed');
        }

        // Update button
        const markBtn = document.getElementById('markCompletedBtn');
        if (markBtn) {
            markBtn.textContent = 'Completed';
            markBtn.disabled = true;
            markBtn.classList.add('btn-secondary');
            markBtn.classList.remove('btn-success');
        }

        updateQuizButton();
        updateCompletedTopics();
    }
    
    function startMainQuiz(lessonType) {
        console.log('Starting quiz:', lessonType);
        currentQuiz = [...mainLessonQuiz[lessonType].questions];
        currentQuestionIndex = 0;
        correctAnswers = 0;

        const quizTitle = document.getElementById('quizTitle');
        const totalQuestions = document.getElementById('totalQuestions');
        const quizModal = document.getElementById('quizModal');
        const nextBtn = document.getElementById('nextQuestionBtn');
        const submitBtn = document.getElementById('submitQuizBtn');
        
        if (!quizTitle || !totalQuestions || !quizModal || !nextBtn || !submitBtn) {
            alert('Quiz elements not found');
            return;
        }
        
        quizTitle.textContent = mainLessonQuiz[lessonType].title;
        totalQuestions.textContent = currentQuiz.length;
        quizModal.classList.add('active');
        quizModal.style.display = 'flex';

        showQuestion();
        nextBtn.style.display = 'inline-flex';
        submitBtn.style.display = 'none';
    }
    
    function showQuestion() {
        const question = currentQuiz[currentQuestionIndex];
        const questionElement = document.getElementById('quizQuestion');
        const optionsContainer = document.getElementById('quizOptions');
        const currentQuestionSpan = document.getElementById('currentQuestion');
        
        if (!questionElement || !optionsContainer || !currentQuestionSpan) {
            alert('Question elements not found');
            return;
        }
        
        currentQuestionSpan.textContent = currentQuestionIndex + 1;
        questionElement.textContent = question.question;

        optionsContainer.innerHTML = '';

        question.options.forEach((option, index) => {
            const optionElement = document.createElement('div');
            optionElement.className = 'quiz-option';
            optionElement.textContent = option;
            optionElement.onclick = function() {
                selectOption(index, this);
            };
            optionsContainer.appendChild(optionElement);
        });

        const nextBtn = document.getElementById('nextQuestionBtn');
        if (nextBtn) nextBtn.disabled = true;
    }
    
    function selectOption(index, element) {
        const options = document.querySelectorAll('.quiz-option');
        options.forEach(opt => opt.classList.remove('selected'));

        element.classList.add('selected');
        selectedOption = index;
        const nextBtn = document.getElementById('nextQuestionBtn');
        if (nextBtn) nextBtn.disabled = false;
    }
    
    function handleNextQuestion() {
        const correctAnswer = currentQuiz[currentQuestionIndex].correct;

        const options = document.querySelectorAll('.quiz-option');
        options.forEach((opt, idx) => {
            opt.style.pointerEvents = 'none';
            if (idx === correctAnswer) {
                opt.classList.add('correct');
            } else if (idx === selectedOption && idx !== correctAnswer) {
                opt.classList.add('incorrect');
            }
        });

        if (selectedOption === correctAnswer) {
            correctAnswers++;
        }

        setTimeout(() => {
            currentQuestionIndex++;
            selectedOption = null;

            if (currentQuestionIndex < currentQuiz.length) {
                showQuestion();
            } else {
                const nextBtn = document.getElementById('nextQuestionBtn');
                const submitBtn = document.getElementById('submitQuizBtn');
                if (nextBtn) nextBtn.style.display = 'none';
                if (submitBtn) submitBtn.style.display = 'inline-flex';
            }
        }, 1500);
    }
    
    function showResults() {
        const score = Math.round((correctAnswers / currentQuiz.length) * 100);
        const total = currentQuiz.length;

        const resultScore = document.getElementById('resultScore');
        const correctCount = document.getElementById('correctCount');
        const totalCount = document.getElementById('totalCount');
        const resultMessage = document.getElementById('resultMessage');
        const resultModal = document.getElementById('quizResultModal');

        if (!resultScore || !correctCount || !totalCount || !resultMessage || !resultModal) {
            alert('Result elements not found');
            return;
        }

        resultScore.textContent = `${score}%`;
        correctCount.textContent = correctAnswers;
        totalCount.textContent = total;

        let message = '';
        if (score === 100) {
            message = 'Perfect! You\'re a safety expert!';
        } else if (score >= 80) {
            message = 'Excellent work! You have great knowledge!';
        } else if (score >= 60) {
            message = 'Good job! Keep learning to improve!';
        } else {
            message = 'Keep practicing! Review the lesson and try again.';
        }

        resultMessage.textContent = message;
        resultModal.classList.add('active');
        resultModal.style.display = 'flex';
    }
    
    function updateQuizButton() {
        const allSafetyTopics = Object.keys(lessons);
        const completedCount = allSafetyTopics.filter(id => completedTopics[id]).length;

        const quizBtn = document.getElementById('safetyQuizBtn');
        if (quizBtn) {
            if (completedCount === allSafetyTopics.length) {
                quizBtn.disabled = false;
                quizBtn.textContent = 'Start Quiz';
            } else {
                quizBtn.disabled = true;
                quizBtn.textContent = `Complete ${allSafetyTopics.length - completedCount} more topic${allSafetyTopics.length - completedCount > 1 ? 's' : ''}`;
            }
        }
    }
    
    function updateCompletedTopics() {
        const allSafetyTopics = Object.keys(lessons);
        const completedCount = allSafetyTopics.filter(id => completedTopics[id]).length;

        const completedSpan = document.getElementById('completedTopics');
        if (completedSpan) {
            completedSpan.textContent = completedCount;
        }
    }
    
    // Initialize page
    function initializePage() {
        console.log('Initializing page...');
        
        // Mark completed topics
        const lessonCards = document.querySelectorAll('.lesson-card');
        lessonCards.forEach(card => {
            const lessonId = card.dataset.lesson;
            if (completedTopics[lessonId]) {
                card.classList.add('completed');
            }
        });
        
        updateQuizButton();
        updateCompletedTopics();
        
        // Add event listeners for buttons that don't have inline handlers
        const nextBtn = document.getElementById('nextQuestionBtn');
        if (nextBtn) {
            nextBtn.onclick = handleNextQuestion;
        }
        
        const submitBtn = document.getElementById('submitQuizBtn');
        if (submitBtn) {
            submitBtn.onclick = function() {
                document.getElementById('quizModal').classList.remove('active');
                showResults();
            };
        }
        
        console.log('Page initialized successfully');
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', initializePage);
    
    // Also try immediate initialization
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializePage);
    } else {
        initializePage();
    }
  </script>
</body>
</html>
